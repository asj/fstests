#!/bin/bash

# SPDX-License-Identifier: GPL-2.0
# Copyright (c) 2025 Oracle.  All Rights Reserved.
#
# Try starting things in a new process session so that test processes have
# something with which to filter only their own subprocesses.

if [ -n "${FSTESTS_ISOL}" ]; then
	# Allow the test to become a target of the oom killer
	oom_knob="/proc/self/oom_score_adj"
	test -w "${oom_knob}" && echo 250 > "${oom_knob}"

	exec "$@"
fi

if [ -z "$1" ] || [ "$1" = "--help" ]; then
	echo "Usage: $0 command [args...]"
	exit 1
fi

FSTESTS_ISOL=setsid exec setsid "$0" "$@"
